# ğŸ¤– JEEX Plan - Advanced CodeRabbit Configuration
# Multi-tenant documentation generation system
# Updated for CodeRabbit 2025 with all advanced features

reviews:
  # Assertive profile for comprehensive analysis
  profile: "assertive"

  # Advanced auto-review settings
  auto_review:
    enabled: true
    drafts: false
    base_branches: ["master", "main", "develop"]

  # Enhanced review features
  request_changes: "auto"
  high_level_summary: true
  poem: true
  review_status: true
  collapse_ellipsis: false

  # Comprehensive toolchain integration
  tools:
    # ğŸ Python backend analysis
    ruff:
      enabled: true
      config_file: "backend/pyproject.toml"

    # âš¡ Frontend code quality
    eslint:
      enabled: true
      config_file: "frontend/eslint.config.js"

    # ğŸ” Security scanning
    gitleaks:
      enabled: true

    # ğŸ³ Docker best practices
    hadolint:
      enabled: true

    # ğŸ–¥ï¸ Shell script validation
    shellcheck:
      enabled: true

    # ğŸ”„ GitHub Actions linting
    actionlint:
      enabled: true

    # ğŸ“¦ Additional quality tools
    oxlint:
      enabled: true

  # ğŸ¯ AST-based security pattern detection
  ast_patterns:
    - id: "tenant-isolation-violation"
      pattern: |
        session.query($MODEL).filter($CONDITION)
      message: "ğŸš¨ SECURITY: Missing tenant_id filter! Ensure multi-tenant isolation."
      severity: "critical"
      paths: ["backend/app/**/*.py"]

    - id: "sql-injection-risk"
      pattern: |
        execute(f"$SQL")
        cursor.execute(f"$SQL")
      message: "ğŸš¨ SECURITY: Potential SQL injection via f-string. Use parameterized queries."
      severity: "critical"

    - id: "hardcoded-secrets"
      pattern: |
        password = "$VALUE"
        api_key = "$VALUE"
        secret = "$VALUE"
        token = "$VALUE"
      message: "ğŸ”‘ SECURITY: Hardcoded secret detected. Use environment variables or Vault."
      severity: "critical"

    - id: "unsafe-eval"
      pattern: |
        eval($CODE)
        exec($CODE)
      message: "âš ï¸ SECURITY: Unsafe code execution. Consider safer alternatives."
      severity: "high"

    - id: "react-security-issues"
      pattern: |
        dangerouslySetInnerHTML={{__html: $CONTENT}}
      message: "ğŸ”’ SECURITY: XSS risk with dangerouslySetInnerHTML. Sanitize content."
      severity: "high"
      paths: ["frontend/**/*.tsx"]

  # ğŸ“ Path-specific intelligent instructions
  path_instructions:
    # ğŸ” Critical security modules
    - path: "backend/app/core/auth.py"
      instructions: |
        ğŸ” **CRITICAL AUTHENTICATION MODULE**
        Security Focus Areas:
        - JWT token validation completeness and security
        - Timing attack prevention in token comparison
        - Proper session management and cleanup
        - Multi-factor authentication implementation
        - Rate limiting for auth endpoints
        - Secure password reset flows
        - **MANDATORY**: Tenant isolation in all auth flows

    - path: "backend/app/core/database.py"
      instructions: |
        ğŸ—„ï¸ **DATABASE CORE MODULE**
        Critical Checks:
        - Connection pooling security and limits
        - Transaction isolation levels
        - Prepared statement usage
        - Database migration safety
        - Tenant-scoped connection validation
        - Backup and recovery considerations

    # ğŸ—ï¸ Data models and architecture
    - path: "backend/app/models/**/*.py"
      instructions: |
        ğŸ—ï¸ **DATABASE MODELS**
        Architecture Review:
        - **MANDATORY**: tenant_id in all tenant-scoped models
        - Foreign key relationships respect tenant boundaries
        - Proper indexing strategy for tenant queries
        - Soft delete implementation consistency
        - Data validation and constraints
        - Migration compatibility
        - Performance optimization for large datasets

    - path: "backend/app/repositories/**/*.py"
      instructions: |
        ğŸ“Š **DATA ACCESS LAYER**
        Repository Pattern Review:
        - Tenant isolation in all queries (CRITICAL)
        - SQL injection prevention
        - Query optimization and N+1 prevention
        - Proper error handling and logging
        - Transaction management
        - Cache invalidation strategies

    # ğŸŒ API endpoints and security
    - path: "backend/app/api/**/*.py"
      instructions: |
        ğŸŒ **API ENDPOINTS**
        Security & Architecture:
        - Input validation and sanitization (Pydantic models)
        - Proper HTTP status codes and error responses
        - Rate limiting implementation
        - Authentication and authorization checks
        - Request/response logging (no sensitive data)
        - API versioning considerations
        - OpenAPI documentation accuracy
        - **CRITICAL**: Multi-tenant access control

    # âš›ï¸ React components and frontend architecture
    - path: "frontend/src/components/**/*.tsx"
      instructions: |
        âš›ï¸ **REACT COMPONENTS**
        Modern React 19+ Best Practices:
        - Component composition and reusability
        - Proper TypeScript prop validation
        - Performance optimization (memo, useMemo, useCallback)
        - Accessibility compliance (ARIA, keyboard navigation)
        - Error boundary integration
        - Security: XSS prevention in dynamic content
        - State management patterns
        - Testing considerations

    - path: "frontend/src/hooks/**/*.ts"
      instructions: |
        ğŸª **CUSTOM HOOKS**
        Hook Architecture Review:
        - Proper dependency arrays (exhaustive-deps)
        - Cleanup in useEffect for subscriptions/timers
        - Error handling and loading states
        - Hook composition patterns
        - Performance considerations
        - Reusability and abstraction levels

    - path: "frontend/src/services/**/*.ts"
      instructions: |
        ğŸ”Œ **FRONTEND SERVICES**
        Service Layer Architecture:
        - API error handling and retry logic
        - Request cancellation (AbortController)
        - Authentication token management
        - Response data validation
        - Caching strategies
        - Offline handling considerations
        - Security: No sensitive data in logs

    # ğŸ”§ Configuration and infrastructure
    - path: "docker-compose.yml"
      instructions: |
        ğŸ³ **DOCKER ORCHESTRATION**
        DevOps Security Review:
        - Non-root user configuration
        - Secrets management (no hardcoded values)
        - Service networking and isolation
        - Health checks implementation
        - Resource limits and quotas
        - Volume security and permissions
        - Multi-stage build optimization

    - path: ".github/workflows/**/*.yml"
      instructions: |
        ğŸ”„ **CI/CD PIPELINES**
        Security & Automation:
        - Secure secret handling (GitHub Secrets)
        - Minimal permissions (GITHUB_TOKEN)
        - Dependency vulnerability scanning
        - Code quality gates
        - Security policy enforcement
        - Deployment strategies
        - Monitoring and alerting

    # ğŸ“¦ Dependency management
    - path: "backend/pyproject.toml"
      instructions: |
        ğŸ”§ **PYTHON DEPENDENCIES**
        Dependency Security:
        - Version pinning strategy
        - Security vulnerability scanning
        - License compatibility
        - Dependency tree analysis
        - Development vs production dependencies
        - Tool configuration consistency

    - path: "frontend/package.json"
      instructions: |
        ğŸ“¦ **FRONTEND DEPENDENCIES**
        Package Management:
        - Security audit results (npm/yarn audit)
        - Version compatibility matrix
        - Peer dependency management
        - Bundle size optimization
        - Tree shaking considerations
        - Runtime vs dev dependencies

    # ğŸ§ª Testing strategies
    - path: "backend/tests/**/*.py"
      instructions: |
        ğŸ§ª **BACKEND TESTING**
        Test Quality Review:
        - Test coverage completeness
        - Security test scenarios
        - Integration test patterns
        - Mocking strategies
        - Test data management
        - Performance test considerations
        - Multi-tenant test isolation

    - path: "frontend/src/**/*.test.{ts,tsx}"
      instructions: |
        ğŸ¯ **FRONTEND TESTING**
        Component Testing:
        - User interaction testing (Testing Library)
        - Accessibility testing integration
        - Error state testing
        - Performance testing (React DevTools)
        - Integration test coverage
        - Mock service strategies

# ğŸ’¬ Chat integration for enhanced collaboration
chat:
  auto_reply: true

# ğŸ§  Knowledge base integration for learning
knowledge_base:
  learnings: true
  web_search: true

# ğŸ¤– AI-powered code generation
code_generation:
  docstrings: true
  unit_tests: true

# ğŸŒ Global configuration
language: "en"
early_access: true

# ğŸ¨ Custom AI personality and focus
tone_instructions: |
  You are an expert code reviewer for JEEX Plan, a sophisticated multi-tenant documentation generation system.

  **PRIMARY FOCUS AREAS:**
  1. ğŸ” **Security First**: Multi-tenant isolation is CRITICAL - never suggest bypassing tenant_id checks
  2. ğŸ—ï¸ **Architecture**: Design patterns, SOLID principles, and scalability
  3. âš¡ **Performance**: Database queries, React rendering, caching strategies
  4. ğŸ›¡ï¸ **Reliability**: Error handling, edge cases, and fault tolerance

  **REVIEW STYLE:**
  - Be thorough but constructive
  - Provide specific, actionable suggestions with code examples
  - Prioritize critical security and architectural issues
  - Acknowledge good practices when you see them
  - Consider the full-stack context (React 19+, TypeScript 5.9+, Python 3.11+, FastAPI 0.116+)

  **AVOID:**
  - Style suggestions handled by Ruff/ESLint
  - Nitpicking on formatting (tools handle this)
  - Suggesting breaking changes without clear benefits
  - Generic advice without project context

  Remember: You're helping build a production-ready, secure, multi-tenant system. Every suggestion should move us toward that goal! ğŸš€